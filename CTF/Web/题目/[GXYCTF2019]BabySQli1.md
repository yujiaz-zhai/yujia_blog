# [GXYCTF2019]BabySQli

**标签：`Union注入` `Fuzz` `Union注入新思路`**

> 传送门：[[GXYCTF2019]BabySQli](https://buuoj.cn/challenges#[GXYCTF2019]BabySQli)

到目前位置也做了有十几道sql注入题了，遇到了一个值得记录一下的题，介绍一下使用`BrupSuite`进行`Fuzz`和一个`Union`注入的新思路

**判断注入类型**

还是经典的登录框，试一下几个弱口令

* `1`: `wrong user!`
* `1'`: `SQL错误`
* `admin`: `wrong pass!`

由此可以发现，首先这是一个字符型注入，其次输入`admin`的时候是回显密码错误，说明确实存在`admin`这个用户，这点很关键，伏笔

**Fuzz**

这些题不再是签到难度了，一般开发者都会设置过滤，所以我们用`Brup`来对题目进行一下`Fuzz`爆破，看看哪些语句被过滤掉了

> 所谓Fuzz爆破我的理解是，就是让程序自动发送请求，通过返回情况，来判断关键词是否被过滤了

所以我们需要一个Fuzz字典，字典很好找，从网上搜索一个就行，基本都涵盖了

然后记录一下基本操作流程，免得后面忘了

1、启动`BrupSuite`，打开代理，抓到请求，右键发送到`Intruder`

2、点开`Position`面板，选中进行爆破的字段，点击右边的`Add`选中

![](../../../\statics\img\CTF\22.png)

3、进入`Payloads`面板，点击`Load`选择你保存好的字典(txt)

![](../../../\statics\img\CTF\23.png)

4、这里最好把线程数调小一点，默认是5，但是这样的话请求过快，可能会被浏览器拦截，请求发不出去，就失去了意义，然后点击`Start attack`开始攻击

![](../../../\statics\img\CTF\24.png)

5、点了开始攻击后等待完成，通过判断回显，419的回显下面的提示都是`do not hack me`说明这些关键字开发者都过滤了，其他一些长度更长的回显显示了报错，说明这些字段没有被过滤，而是当作SQL语句被执行，当然会报错，因此我们就知道了哪些被过滤，哪些没有被过滤

![](../../../\statics\img\CTF\25.png)

![](../../../\statics\img\CTF\26.png)

**尝试注入**

`Fuzz`过后，会发现左右括号都被过滤掉了，这就很蛋疼，这样的话我们的报错注入就用不了了，但是union,select,没有被滤掉，而且因为SQL是不区分大小写的，所以即使order被过滤了，ORDER BY还可以使用，所以这里我们就尝试一下用union注入

**尝试查一下字段数**

```
1' ORDER BY 4%23
```

![](../../../\statics\img\CTF\27.png)

4的时候报错了，所以字段数为3

要依据我们以前的想法，那么下一步就是去查`database()`，但是括号没了，查不了，怎么办？

**新思路**

`Union`查询有个特性，所查询的数据不存在时，联合查询会构造一个虚拟的数据，简单来说，就是在本轮查询中，如果union的东西不存在，那就会创建一个并加入到数据库中，成为一条真实数据，这就很搞了，还记得我们前面说我们已经知道了确实有一个用户叫`admin`，我们现在不知道密码，那既然`union`这么狠，我们直接创建一个虚假的admin数据，自己随便写一个密码，不就相当于创建了一个虚假但可以登录的`admin`用户了吗？

依照这个想法，我们做一下实践：

由于不知道保存`admin`的`name`列在哪一列，我们可以在这三个位置都试一试

```
name=1' union select 'admin',2,3%23&pw=1
name=1' union select 1,'admin',3%23&pw=1
name=1' union select 1,2,'admin'%23&pw=1
```

发现只有在第二个位置发送请求的时候，回显是`wrong pass`，说明admin列就在第2列，那么相应的，`pw`列一定就在第3列了

那么可以构造一个假数据放上去

```
name=1' union select 1,'admin',1%23&pw=1
```

这里的意思是构造了一个密码为1的admin上去，并且请求的`pw=1`，按理说密码正确是可以登陆上去的，但实际上登陆不上去，这就很难受了，看了题解发现这里的密码用了`md5`加密了一下，giao，这谁知道啊，也看不到源码

所以把密码加密一下再发一遍请求

```
name=1' union select 1,'admin','c4ca4238a0b923820dcc509a6f75849b'%23&pw=1
```

成功拿到`flag`

```
flag{f3b93156-45b7-4caf-ae38-d63c3e377424}
```

